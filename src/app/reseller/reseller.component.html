<!-- Visualizzazione dei dati del reseller (modalità sola lettura) -->
<div *ngIf="reseller">
  <h1 *ngIf="userRole === 'ROLE_RESELLER'">
    Benvenuto {{ reseller.username }}
  </h1>
  <h1 *ngIf="userRole !== 'ROLE_RESELLER'">Informazioni del rivenditore</h1>
  <div class="row">
    <div class="col-md-4">
      <img [src]="imgUrl + reseller.avatar" alt="Avatar" class="img-fluid" />
    </div>
    <div class="col-md-8">
      <p><strong>Email:</strong> {{ reseller.email }}</p>
      <p><strong>Nome:</strong> {{ reseller.name }}</p>
      <p><strong>Cognome:</strong> {{ reseller.surname }}</p>
      <p><strong>Telefono:</strong> {{ reseller.phoneNumber }}</p>
      <p><strong>Ragione Sociale:</strong> {{ reseller.ragioneSociale }}</p>
      <p><strong>Partita IVA:</strong> {{ reseller.partitaIva }}</p>
      <p><strong>Sito Web:</strong> {{ reseller.sitoWeb }}</p>
      <p>
        <strong>Rating medio:</strong>
        {{ reseller.ratingMedio | number : "1.1-1" }} / 5
      </p>
    </div>
  </div>
  <!-- Pulsante di modifica visibile solo se l'utente loggato ha il ruolo reseller -->
  <div *ngIf="userRole === 'ROLE_RESELLER'" class="mt-3">
    <button class="btn btn-primary" (click)="toggleEdit()">
      Modifica i tuoi dati
    </button>
  </div>
</div>

<!-- Form di aggiornamento in modalità editabile -->
<div *ngIf="editMode">
  <form [formGroup]="resellerForm" (ngSubmit)="onSubmit()">
    <!-- Username (sola lettura) -->
    <div class="form-group">
      <label>Username</label>
      <input
        type="text"
        formControlName="username"
        class="form-control"
        readonly
      />
    </div>

    <!-- Email -->
    <div class="form-group">
      <label>Email</label>
      <input type="email" formControlName="email" class="form-control" />
    </div>

    <!-- Nome -->
    <div class="form-group">
      <label>Nome</label>
      <input type="text" formControlName="name" class="form-control" />
    </div>

    <!-- Cognome -->
    <div class="form-group">
      <label>Cognome</label>
      <input type="text" formControlName="surname" class="form-control" />
    </div>

    <!-- Telefono -->
    <div class="form-group">
      <label>Telefono</label>
      <input type="text" formControlName="phoneNumber" class="form-control" />
    </div>

    <!-- Ragione Sociale -->
    <div class="form-group">
      <label>Ragione Sociale</label>
      <input
        type="text"
        formControlName="ragioneSociale"
        class="form-control"
      />
    </div>

    <!-- Partita IVA -->
    <div class="form-group">
      <label>Partita IVA</label>
      <input type="text" formControlName="partitaIva" class="form-control" />
    </div>

    <!-- Sito Web -->
    <div class="form-group">
      <label>Sito Web</label>
      <input type="text" formControlName="sitoWeb" class="form-control" />
    </div>

    <!-- Input per aggiornare l'avatar (opzionale) -->
    <div class="form-group">
      <label>Avatar</label>
      <input
        type="file"
        (change)="onAvatarSelected($event)"
        class="form-control"
      />
    </div>

    <!-- Pulsanti per submit e annulla -->
    <div class="mt-3">
      <button
        type="submit"
        class="btn btn-success"
        [disabled]="!resellerForm.valid"
      >
        Salva
      </button>
      <button
        type="button"
        class="btn btn-secondary ml-2"
        (click)="toggleEdit()"
      >
        Annulla
      </button>
    </div>
  </form>
</div>

<!-- Sezione per caricare un nuovo prodotto, visibile solo al rivenditore -->
<div class="m-5" *ngIf="userRole === 'ROLE_RESELLER'">
  <button class="btn btn-primary" routerLink="/new-autopart">Carica</button>
</div>

<!-- Sezione per visualizzare gli articoli (autoparts) -->
<h2 class="mt-5">Prodotti del rivenditore</h2>
<div class="row">
  <div *ngFor="let autopart of autoparts" class="col-12 col-md-6 col-lg-3 mb-4">
    <div class="card h-100">
      <img
        [src]="imgUrl + autopart.immagine || 'assets/placeholder.png'"
        class="card-img-top img-fluid p-3 h-100"
        alt="{{ autopart.nome }}"
      />
      <div class="card-body">
        <h5 class="card-title">{{ autopart.nome }}</h5>
        <p class="card-text">
          Prezzo: {{ autopart.prezzi[0].importo | currency : "EUR" }}
        </p>
        <p class="card-text">Codice OE: {{ autopart.codiceOe }}</p>
      </div>
      <div class="card-footer">
        <button
          *ngIf="userRole === 'ROLE_RESELLER'"
          class="btn btn-warning btn-sm me-2"
          [routerLink]="['/reseller/edit-autopart', autopart.id]"
        >
          Modifica
        </button>
        <button
          *ngIf="userRole === 'ROLE_RESELLER'"
          class="btn btn-danger btn-sm"
          (click)="deleteAutopart(autopart.id)"
        >
          Elimina
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Sezione per lasciare una valutazione (visibile solo a utenti con ruolo USER) -->
<div class="m-5" *ngIf="userRole !== 'ROLE_RESELLER'">
  <h3>Lascia la tua valutazione</h3>
  <form (ngSubmit)="submitRating()">
    <div class="form-group">
      <label for="ratingSelect">Voto (1-5):</label>
      <select
        id="ratingSelect"
        [(ngModel)]="newRating.rating"
        name="rating"
        required
        class="form-control"
      >
        <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">{{ r }}</option>
      </select>
    </div>
    <div class="form-group mt-2">
      <label for="ratingComment">Commento (opzionale):</label>
      <textarea
        id="ratingComment"
        [(ngModel)]="newRating.comment"
        name="comment"
        class="form-control"
        rows="3"
      ></textarea>
    </div>
    <button type="submit" class="btn btn-primary mt-3">
      Invia valutazione
    </button>
  </form>
</div>
