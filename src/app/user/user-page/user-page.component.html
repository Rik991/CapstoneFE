<div *ngIf="user">
  <div class="container">
    <div class="row">
      <h1 *ngIf="isOwner; else notOwnerTitle">
        Benvenuto, {{ user.username }}
      </h1>
      <ng-template #notOwnerTitle>
        <h1>Informazioni dell'utente</h1>
      </ng-template>
      <div class="col-12 d-flex align-items-center">
        <!-- immagine a sinistra  -->
        <div class="col-4">
          <img
            [src]="imgUrl + user.avatar"
            alt="userImg"
            class="img-fluid rounded mb-2"
          />
          <div *ngIf="isOwner && editMode">
            <button class="btn btn-outline-primary" (click)="fileInput.click()">
              Modifica foto
            </button>
            <input
              type="file"
              #fileInput
              style="display: none"
              (change)="onAvatarSelected($event)"
            />
          </div>
        </div>
        <!-- info a destra  -->
        <div class="col-8">
          <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
            <!-- Email -->
            <div class="form-group">
              <label>Email:</label>
              <input
                type="email"
                formControlName="email"
                class="form-control"
                [readonly]="!editMode"
              />
            </div>

            <!-- Nome -->
            <div class="form-group">
              <label>Nome:</label>
              <input
                type="text"
                formControlName="name"
                class="form-control"
                [readonly]="!editMode"
              />
            </div>

            <!-- Cognome -->
            <div class="form-group">
              <label>Cognome:</label>
              <input
                type="text"
                formControlName="surname"
                class="form-control"
                [readonly]="!editMode"
              />
            </div>

            <!-- Telefono -->
            <div class="form-group">
              <label>Telefono:</label>
              <input
                type="text"
                formControlName="phoneNumber"
                class="form-control"
                [readonly]="!editMode"
              />
            </div>
            <!-- sezione pulsanti  -->
            <div *ngIf="isOwner" class="mt-3">
              <ng-container *ngIf="editMode; else viewModeButtons">
                <!-- In modalità edit: mostra i pulsanti per salvare e annullare -->
                <button
                  type="submit"
                  class="btn btn-success"
                  [disabled]="!userForm.valid"
                >
                  Salva
                </button>
                <button
                  type="button"
                  class="btn btn-secondary ml-2"
                  (click)="toggleEdit()"
                >
                  Annulla
                </button>
              </ng-container>
              <ng-template #viewModeButtons>
                <!-- In modalità non-edit: mostra il pulsante per attivare la modalità edit -->
                <button
                  type="button"
                  class="btn btn-primary"
                  (click)="toggleEdit()"
                >
                  Modifica i tuoi dati
                </button>
              </ng-template>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="row mt-5">
      <h2>I tuoi preferiti</h2>
      <div
        *ngFor="let autopart of favouriteAutoparts"
        class="col-12 col-md-6 col-lg-4 mb-4"
      >
        <div class="card h-100">
          <img
            [src]="imgUrl + autopart.immagine || 'assets/placeholder.png'"
            class="card-img-top img-fluid p-3 position-relative"
            alt="{{ autopart.nome }}"
          />
          <button
            class="btn btn-link position-absolute end-0"
            (click)="toggleFavourite(autopart.id)"
          >
            <i
              [ngClass]="{
                'bi-heart-fill text-danger': favouriteIds.has(autopart.id),
                'bi-heart text-muted': !favouriteIds.has(autopart.id)
              }"
              class="bi fs-5"
            ></i>
          </button>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ autopart.nome }}</h5>
            <p class="card-text flex-grow-1">{{ autopart.descrizione }}</p>
            <h5>Codice Oe: {{ autopart.codiceOe }}</h5>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="badge bg-primary me-2" *ngIf="autopart.reseller">
                  <a class="text-white" [href]="autopart.reseller.sitoWeb">{{
                    autopart.reseller.ragioneSociale
                  }}</a>
                </span>
                <span class="badge bg-secondary">{{
                  autopart.condizione
                }}</span>
              </div>
              <h4>
                {{ autopart.prezzi[0].importo | currency : "EUR" }}
              </h4>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
